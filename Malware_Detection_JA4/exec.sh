#!/bin/bash

# Directorio que contiene los archivos pcap
input_dir="/media/fingopolo/Maxtor/TFG/DATASET2/mobile-malware/android14"

# Directorio donde se guardarán las sesiones
output_base_dir="/media/fingopolo/Maxtor/TFG/JA4/DATASET2/mobile-malware/android14"

# Crear el directorio de salida si no existe
mkdir -p "$output_base_dir"

# Recorrer todos los archivos .pcapng en el directorio
for input_pcap_file in "$input_dir"/*.pcap; do
    # Extraer el nombre del archivo sin la extensión
    file_name=$(basename "$input_pcap_file" .pcapng)
    
    # Definir el directorio de salida específico para cada archivo
    output_dir="${output_base_dir}/${file_name}"
    
    # Crear el directorio de salida si no existe
    mkdir -p "$output_dir"

    echo "Procesando ${input_pcap_file}..."

    # Ejecutar el script con las variables adecuadas
    ./tools/get-ja4.sh "$input_pcap_file" -a "Malware Android14" -t M -d "$output_dir" -w "utils/whois.txt"

    echo "Procesamiento de ${input_pcap_file} completado.\n"
done

echo "Todos los archivos han sido procesados."



